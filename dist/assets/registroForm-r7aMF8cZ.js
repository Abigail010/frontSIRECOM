import{y as ot,H as c,a4 as rt,D as st,E as lt,o as u,c as m,b as o,w as s,z as w,d,s as v,k as F,a as r,F as q,x as it,t as V,V as dt,a3 as nt,a2 as L,r as $}from"./index-JAwHJP07.js";import{B as ut}from"./BaseBreadcrumb-StOoMpz7.js";import{u as mt}from"./filtro-DNQPrwHm.js";import{u as ft}from"./register_rep-BuHminS1.js";import{u as pt}from"./resource-Ci3chK7-.js";import{v as E}from"./validateText-UQqnbmko.js";import{u as ct}from"./busqueda-C0-jt5yM.js";import{f as _t}from"./index-CEwlp1in.js";import{V as Dt}from"./VDialog-Cw9ONvI0.js";import{V as vt,a as bt,b as gt,c as Vt}from"./VCard-CsHHC5sn.js";import{V as ht}from"./VContainer-BPPwdmST.js";import{a as T,V as i}from"./VRow-BB4zhKCx.js";import{V as D}from"./VTextField-QxAc7xOP.js";import{V as N}from"./VAutocomplete-FsH0my16.js";import{V as yt}from"./VSpacer-BDb16B0V.js";import{V as b}from"./VBtn-C5jtH31I.js";import{V as g}from"./VLabel-DPouV-8a.js";import{V as xt}from"./VSelect-B1EryTsM.js";import{V as wt}from"./VTable-BC7_NEIP.js";import"./useRender-u9yhkulO.js";import"./router-CLZtO6zl.js";import"./index-DT2YvziZ.js";import"./VOverlay-QfRP5H7q.js";import"./forwardRefs-D3j0TLhE.js";import"./lazy-B4tNk2AD.js";import"./scopeId-B0VhqATy.js";import"./transition-DEFqdhol.js";import"./dialog-transition-9yqe0bmC.js";import"./VAvatar-BsqQRn81.js";import"./VField-CENBNaAu.js";import"./index-BowncXEn.js";import"./VInput-C11GWGF-.js";import"./filter-CtVkMj8g.js";import"./VList-IvviS1qB.js";import"./ssrBoot-DLV3vtSv.js";import"./VDivider-bav4r4CR.js";import"./VMenu-DIKp8Q6T.js";import"./VCheckboxBtn-Dc4L8CX_.js";import"./VSelectionControl-h2iX9IvA.js";import"./VChip-AW2-eCAO.js";import"./VSlideGroup-BslsTQ6g.js";import"./group-CKCeVWPc.js";import"./resizeObserver-D80J3W28.js";import"./VProgressCircular-BUXsBcGT.js";const kt=r("span",{class:"text-h5"},"Información del Repuesto",-1),Ct=r("h4",{class:"mb-5 mt-2 font-weight-light"},[r("strong",null," DATOS DEL REGISTRO:"),d(" Los campos con "),r("span",{style:{color:"red"}},"(*)"),d(" son obligatorios ")],-1),Rt=r("span",{style:{color:"red"}},"(*)",-1),It={key:0,class:"v-messages font-weight-black px-2 py-2"},St=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Ut=[St],Bt=r("span",{style:{color:"red"}},"(*)",-1),Ft={key:0,class:"v-messages font-weight-black px-2 py-2"},$t=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Et=[$t],Tt=r("h4",{class:"mb-5 mt-2 primary"},[r("strong",null," Registro de repuestos:")],-1),Nt=r("span",{style:{color:"red"}},"(*)",-1),zt={key:0,class:"v-messages font-weight-black px-2 py-2"},Mt=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),At=[Mt],qt=r("span",{style:{color:"red"}},"(*)",-1),Lt={key:0,class:"v-messages font-weight-black px-2 py-2"},Pt=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Ot=[Pt],Jt=r("span",{style:{color:"red"}},"(*)",-1),Gt={key:0,class:"v-messages font-weight-black px-2 py-2"},Ht=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),jt=[Ht],Kt=r("span",{style:{color:"red"}},"(*)",-1),Qt={key:0,class:"v-messages font-weight-black px-2 py-2"},Wt=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Xt=[Wt],Yt=r("span",{style:{color:"red"}},null,-1),Zt=r("thead",null,[r("tr",null,[r("th",{class:"text-center"},"N° "),r("th",{class:"text-center"},[r("b",null," Repuesto")]),r("th",{class:"text-center"},[r("b",null," Unidad")]),r("th",{class:"text-center"},[r("b",null," Cantidad")]),r("th",{class:"text-center"},[r("b",null," Precio Unitario")]),r("th",{class:"text-center"},[r("b",null,"Importe Bs.")]),r("th",{class:"text-center"},"Acción")])],-1),te={class:"text-center"},ee={class:"text-center"},ae={class:"text-center"},oe={class:"text-center"},re={class:"text-center"},se={class:"text-center"},le={key:0,class:"text-center"},ie={key:1,class:"text-center"},de=r("b",null," !Agotado¡",-1),ne=[de],ue={key:2,class:"text-center"},me=r("td",null,null,-1),fe=r("td",null,null,-1),pe=r("td",null,null,-1),ce=r("td",null,null,-1),_e=r("td",{class:"text-center"},[r("b",null,"Total: ")],-1),De={class:"text-center"},ve=r("br",null,null,-1),be={class:"text-lg-left"},ua=ot({__name:"registroForm",setup(ge){const P=ct(),y=ft(),x=c(!1),I=rt();mt(),pt(),JSON.parse(localStorage.getItem("user")||"").id_perfil,JSON.parse(localStorage.getItem("user")||"").id_taller;const O=c({title:"Registro de Repuesto"}),J=c([{text:"Dashboard",disabled:!1,href:"#"},{text:"Información",disabled:!0,href:"#"}]),S=_t(new Date,"yyyy-MM-dd"),t=st({formData:{id:"",fecha:S,id_taller:null,partida:"",total:"0",observacion:"",repuestos:[],nombre_repuesto:"",id_repuesto:"",cantidad:"",precio_u:"",subtotal:"",unidad:"",idd:""}}),z=c([]),G=c(!1);c([]);const H=c([]),U=c([]),f=c([]),j=async()=>{const l=await P.general_data_for_search();z.value=l.fuerza,H.value=l.servicio,f.value=l.repuestos,U.value=l.unidad},K=async l=>{const e=await y.RegisterR(l);t.formData.id=e.id,t.formData.fecha=e.fecha,t.formData.partida=e.nro_partida,t.formData.id_taller=e.id_taller,t.formData.observacion=e.observacion;const _=e.repuestos;for(let p=0;p<_.length;p++)t.formData.repuestos.push(_[p]),f.value=f.value.filter(h=>h.id!=_[p].id_repuesto),t.formData.total=String(parseFloat(t.formData.total)+parseFloat(_[p].subtotal))},B=c(!0),k=async()=>{B.value=!0,(!t.formData.fecha||t.formData.repuestos.length==0)&&(B.value=!1)},Q=async l=>{const e=await y.infoR(l);t.formData.idd=e.idd,t.formData.id_repuesto=e.id_repuesto,t.formData.nombre_repuesto=e.nombre_repuesto,t.formData.cantidad=e.cantidad,t.formData.unidad=e.unidad,t.formData.precio_u=e.precio_u,t.formData.subtotal=e.subtotal,x.value=!0},W=()=>{t.formData.id_repuesto="",t.formData.nombre_repuesto="",t.formData.cantidad="",t.formData.unidad="",t.formData.precio_u=""},C=()=>{const l=parseFloat(t.formData.cantidad)||0,e=parseFloat(t.formData.precio_u)||0;t.formData.subtotal=(l*e).toFixed(2)},X=()=>{if(t.formData.id_repuesto&&t.formData.cantidad&&t.formData.unidad&&t.formData.precio_u){let l=f.value.find(e=>e.id==t.formData.id_repuesto);if(l)t.formData.nombre_repuesto=l.nombre_repuesto;else return;f.value=f.value.filter(e=>e.id!=t.formData.id_repuesto),t.formData.repuestos.push({id_repuesto:t.formData.id_repuesto,nombre_repuesto:l.nombre_repuesto,cantidad:t.formData.cantidad,unidad:t.formData.unidad,precio_u:t.formData.precio_u,subtotal:t.formData.subtotal}),t.formData.total=String(parseFloat(t.formData.total)+parseFloat(t.formData.subtotal)),t.formData.id_repuesto="",t.formData.nombre_repuesto="",t.formData.cantidad="",t.formData.unidad="",t.formData.precio_u="",t.formData.subtotal=""}},M=l=>{if(t.formData.repuestos.length>0){const e=t.formData.repuestos[l];f.value.push({id:e.id_repuesto,nombre_repuesto:e.nombre_repuesto}),t.formData.total=String(parseFloat(t.formData.total)-parseFloat(e.subtotal)),f.value.sort((_,p)=>{const h=_.id,a=p.id;return h<a?-1:h>a?1:0}),t.formData.repuestos.splice(l,1)}},Y=()=>{t.formData.id_repuesto&&t.formData.cantidad&&t.formData.unidad&&(f.value=f.value.filter(l=>l.id!=t.formData.id_repuesto),t.formData.repuestos.push({id_repuesto:t.formData.id_repuesto,nombre_repuesto:t.formData.nombre_repuesto,cantidad:t.formData.cantidad,unidad:t.formData.unidad,precio_u:t.formData.precio_u}),t.formData.id_repuesto="",t.formData.nombre_repuesto="",t.formData.cantidad="",t.formData.unidad="",t.formData.precio_u="")},Z=()=>{x.value=!1},tt=()=>{nt.push({name:"registerList"})},n=c(!1),et=async()=>{if(n.value=!0,await k(),!B.value)return;const{ok:l,message:e}=I.params.id=="0"?await y.createRegisterR(t.formData):await y.updateRegisterR(t.formData),_=l?"success":"error";L.fire({icon:_,title:e,timer:1500,showConfirmButton:!1,timerProgressBar:!0})},at=async()=>{n.value=!0,t.formData.idd!="0"&&(x.value=!1,L.fire({title:"Estás seguro?",text:"Verifica que la información registrada sea correcta",icon:"warning",showCancelButton:!0,cancelButtonColor:"#FA896B",confirmButtonColor:"#5D87FF",cancelButtonText:"No, volver",confirmButtonText:"Si, actualizar"}).then(async l=>{l.isConfirmed&&await y.updateInfo(t.formData),window.location.reload()}))};return lt(async()=>{await j(),I.params.id!="0"&&(await K(I.params.id),G.value=!0)}),(l,e)=>{const _=$("SearchIcon"),p=$("TrashIcon"),h=$("PencilIcon");return u(),m(q,null,[o(ut,{title:O.value.title,breadcrumbs:J.value},null,8,["title","breadcrumbs"]),o(T,null,{default:s(()=>[o(Dt,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=a=>x.value=a),"max-width":"1000px"},{default:s(()=>[o(vt,null,{default:s(()=>[o(bt,{class:"pa-2 bg-primary"},{default:s(()=>[kt]),_:1}),o(gt,null,{default:s(()=>[o(ht,null,{default:s(()=>[o(T,null,{default:s(()=>[o(i,{cols:"12",md:"4"},{default:s(()=>[o(D,{modelValue:t.formData.nombre_repuesto,"onUpdate:modelValue":e[0]||(e[0]=a=>t.formData.nombre_repuesto=a),label:"Repuesto"},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(N,{variant:"outlined",color:"primary",label:"Unidad","hide-details":"",items:U.value,modelValue:t.formData.unidad,"onUpdate:modelValue":e[1]||(e[1]=a=>t.formData.unidad=a),"no-data-text":"No existe más opciones para seleccionar","item-value":"nombre_unidad","item-title":"nombre_unidad",onInput:e[2]||(e[2]=a=>t.formData.unidad=w(E)(t.formData.unidad.toUpperCase()))},null,8,["items","modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(D,{onInput:e[3]||(e[3]=a=>(C(),t.formData.cantidad)),modelValue:t.formData.cantidad,"onUpdate:modelValue":e[4]||(e[4]=a=>t.formData.cantidad=a),label:"Cantidad",type:"number",min:1},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(D,{onInput:e[5]||(e[5]=a=>(C(),t.formData.precio_u)),modelValue:t.formData.precio_u,"onUpdate:modelValue":e[6]||(e[6]=a=>t.formData.precio_u=a),label:"Precio Unitaro",type:"number",min:1},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(D,{modelValue:t.formData.subtotal,"onUpdate:modelValue":e[7]||(e[7]=a=>t.formData.subtotal=a),"min:0":"",label:"Importe",readonly:"",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(Vt,null,{default:s(()=>[o(yt),o(b,{color:"error",variant:"flat",dark:"",onClick:e[8]||(e[8]=a=>Z())},{default:s(()=>[d(" Cancel ")]),_:1}),o(b,{color:"success",variant:"flat",dark:"",onClick:e[9]||(e[9]=a=>at())},{default:s(()=>[d(" Actualizar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(i,{cols:"12",lg:"12"},{default:s(()=>[Ct,o(T,null,{default:s(()=>[o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d(" Fecha de Registro"),Rt]),_:1}),o(D,{type:"date",id:"date",name:"date",modelValue:t.formData.fecha,"onUpdate:modelValue":e[11]||(e[11]=a=>t.formData.fecha=a),min:w(S),max:w(S),error:n.value&&!t.formData.fecha,"hide-details":""},null,8,["modelValue","min","max","error"]),n.value&&!t.formData.fecha?(u(),m("div",It,Ut)):v("",!0)]),_:1}),o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("N° de partida ")]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.partida,"onUpdate:modelValue":e[12]||(e[12]=a=>t.formData.partida=a),modelModifiers:{trim:!0},onInput:e[13]||(e[13]=a=>(k(),t.formData.partida)),error:n.value&&!t.formData.partida,"hide-details":""},null,8,["modelValue","error"])]),_:1}),o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Fuerza"),Bt]),_:1}),o(xt,{items:z.value,"item-title":"nombre_fuerza","item-value":"id_fuerza",modelValue:t.formData.id_taller,"onUpdate:modelValue":e[14]||(e[14]=a=>t.formData.id_taller=a),error:n.value&&!t.formData.id_taller},null,8,["items","modelValue","error"]),n.value&&!t.formData.id_taller?(u(),m("div",Ft,Et)):v("",!0)]),_:1}),o(i,{cols:"12",md:"12"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Observación ")]),_:1}),o(D,{variant:"outlined",color:"primary",type:"text",modelValue:t.formData.observacion,"onUpdate:modelValue":e[15]||(e[15]=a=>t.formData.observacion=a),modelModifiers:{trim:!0},onInput:e[16]||(e[16]=a=>(k(),t.formData.observacion=w(E)(t.formData.observacion.toUpperCase()))),"hide-details":""},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"12"},{default:s(()=>[Tt]),_:1}),o(i,{cols:"12",md:"3"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Repuestos "),Nt]),_:1}),o(N,{variant:"outlined",modelValue:t.formData.id_repuesto,"onUpdate:modelValue":e[17]||(e[17]=a=>t.formData.id_repuesto=a),items:f.value,"item-title":"nombre_repuesto","item-value":"id",onInput:e[18]||(e[18]=a=>k()),error:n.value&&!t.formData.id_repuesto,"hide-details":""},null,8,["modelValue","items","error"]),n.value&&!t.formData.id_repuesto?(u(),m("div",zt,At)):v("",!0)]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Unidad"),qt]),_:1}),o(N,{variant:"outlined",color:"primary","hide-details":"",items:U.value,modelValue:t.formData.unidad,"onUpdate:modelValue":[e[19]||(e[19]=a=>t.formData.unidad=a),e[21]||(e[21]=a=>Y())],"no-data-text":"No existe más opciones para seleccionar","item-value":"nombre_unidad","item-title":"nombre_unidad",onInput:e[20]||(e[20]=a=>t.formData.unidad=w(E)(t.formData.unidad.toUpperCase()))},null,8,["items","modelValue"]),n.value&&!t.formData.unidad?(u(),m("div",Lt,Ot)):v("",!0)]),_:1}),o(i,{cols:"12",md:"1"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Cantidad "),Jt]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.cantidad,"onUpdate:modelValue":e[22]||(e[22]=a=>t.formData.cantidad=a),modelModifiers:{trim:!0},onInput:e[23]||(e[23]=a=>(C(),t.formData.cantidad)),min:1,error:n.value&&!t.formData.cantidad,"hide-details":""},null,8,["modelValue","error"]),n.value&&!t.formData.cantidad?(u(),m("div",Gt,jt)):v("",!0)]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Precio Unitario "),Kt]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.precio_u,"onUpdate:modelValue":e[24]||(e[24]=a=>t.formData.precio_u=a),modelModifiers:{trim:!0},onInput:e[25]||(e[25]=a=>(C(),t.formData.precio_u)),min:1,error:n.value&&!t.formData.precio_u,"hide-details":""},null,8,["modelValue","error"]),n.value&&!t.formData.precio_u?(u(),m("div",Qt,Xt)):v("",!0)]),_:1}),o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Importe Bs."),Yt]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.subtotal,"onUpdate:modelValue":e[28]||(e[28]=a=>t.formData.subtotal=a),modelModifiers:{trim:!0},readonly:"",error:n.value&&!t.formData.subtotal,"hide-details":""},{append:s(()=>[o(b,{color:"primary",onClick:e[26]||(e[26]=a=>X()),disabled:!t.formData.id_repuesto||!t.formData.cantidad||!t.formData.unidad||!t.formData.precio_u,readonly:"true"},{default:s(()=>[o(_),d("Añadir ")]),_:1},8,["disabled"]),o(b,{color:"secondary",onClick:e[27]||(e[27]=a=>W()),disabled:!t.formData.id_repuesto||!t.formData.cantidad||!t.formData.unidad||!t.formData.precio_u},{default:s(()=>[o(p),d("Limpiar ")]),_:1},8,["disabled"])]),_:1},8,["modelValue","error"])]),_:1}),t.formData.repuestos.length>0?(u(),F(i,{key:0,cols:"12",md:"12"},{default:s(()=>[o(wt,{density:"compact"},{default:s(()=>[Zt,r("tbody",null,[(u(!0),m(q,null,it(t.formData.repuestos,(a,R)=>(u(),m("tr",{key:R},[r("td",te,V(R+1),1),r("td",ee,V(a.nombre_repuesto),1),r("td",ae,V(a.unidad),1),r("td",oe,V(a.cantidad),1),r("td",re,V(a.precio_u),1),r("td",se,V(a.subtotal),1),a.entregado!=a.cantidad&&t.formData.id!=""?(u(),m("td",le,[a.idd!=null?(u(),F(b,{key:0,class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"primary",text:"hola",onClick:A=>Q(a.idd)},{default:s(()=>[o(h)]),_:2},1032,["onClick"])):v("",!0),a.entregado===null||a.entregado===0||a.idd==null?(u(),F(b,{key:1,size:"x-small",title:"Eliminar",height:"25",width:"25",color:"error",onClick:A=>M(R)},{default:s(()=>[o(p)]),_:2},1032,["onClick"])):v("",!0)])):(a.entregado=a.cantidad)&&t.formData.id!=""?(u(),m("td",ie,ne)):(u(),m("td",ue,[o(b,{size:"x-small",title:"Eliminar",height:"25",width:"25",color:"error",onClick:A=>M(R)},{default:s(()=>[o(p)]),_:2},1032,["onClick"])]))]))),128)),r("tr",null,[me,fe,pe,ce,_e,r("td",De,V(t.formData.total)+" Bs.",1)])])]),_:1})]),_:1})):v("",!0)]),_:1}),ve,r("p",be,[o(b,{color:"error",class:"mr-3",onClick:e[29]||(e[29]=a=>tt())},{default:s(()=>[d("Cancelar")]),_:1}),o(b,{color:"primary",onClick:e[30]||(e[30]=dt(a=>et(),["prevent"]))},{default:s(()=>[d("Enviar")]),_:1})])]),_:1})]),_:1})],64)}}});export{ua as default};
