import{y as dt,H as c,a4 as nt,D as ut,E as mt,o as u,c as m,b as o,w as s,z as w,d,s as v,k as F,a as r,F as P,x as ft,t as V,V as pt,a3 as ct,a2 as O,r as $}from"./index-CszBAM03.js";import{B as _t}from"./BaseBreadcrumb-DwdMcImx.js";import{u as Dt}from"./filtro-CFRDLdA_.js";import{u as vt}from"./register_rep-DqiXf3yZ.js";import{u as bt}from"./resource-gnRvB98_.js";import{v as E}from"./validateText-UQqnbmko.js";import{u as gt}from"./user-DQ88wOj9.js";import{u as Vt}from"./fuerza-DIWKmFA9.js";import{f as yt}from"./index-DXwH83Si.js";import{V as ht}from"./VDialog-D8lq6upT.js";import{V as xt,a as wt,b as kt,c as Ct}from"./VCard-BTpief3e.js";import{V as Rt}from"./VContainer-BXlBqOco.js";import{a as T,V as i}from"./VRow-DBcpD8Qp.js";import{V as D}from"./VTextField-9IO55YPG.js";import{V as N}from"./VAutocomplete-Bd8eTzmH.js";import{V as St}from"./VSpacer-BpWp5T5c.js";import{V as b}from"./VBtn-Dq3bGSJl.js";import{V as g}from"./VLabel-BtCFtaTj.js";import{V as Ut}from"./VSelect-_3e7L0gA.js";import{V as It}from"./VTable-KhQQq0Wt.js";import"./useRender-DOYTO3KG.js";import"./router-DFOTdtPw.js";import"./index-DT2YvziZ.js";import"./VOverlay-B4mnRK_2.js";import"./forwardRefs-D3j0TLhE.js";import"./lazy-Bzbiuov3.js";import"./scopeId-8SGJqsHn.js";import"./transition-W-nos0ap.js";import"./dialog-transition-3tsliuNe.js";import"./VAvatar-BKZImlRa.js";import"./VField-C-F8V5sK.js";import"./index-LAUdzUTV.js";import"./VInput-0KAS55SC.js";import"./filter-CpnkG-P5.js";import"./VList-C33xlGF1.js";import"./ssrBoot-BElN-gkj.js";import"./VDivider-vSm4-OLf.js";import"./VMenu-D4LASOd-.js";import"./VCheckboxBtn-8utVmdr7.js";import"./VSelectionControl-Bj0429w5.js";import"./VChip-O0CpkqDE.js";import"./VSlideGroup-DarFEWBw.js";import"./group-CRVrfb2c.js";import"./resizeObserver-CUpPeGSI.js";import"./VProgressCircular-D3_p53Ys.js";const Bt=r("span",{class:"text-h5"},"Información del Repuesto",-1),Ft=r("h4",{class:"mb-5 mt-2 font-weight-light"},[r("strong",null," DATOS DEL REGISTRO:"),d(" Los campos con "),r("span",{style:{color:"red"}},"(*)"),d(" son obligatorios ")],-1),$t=r("span",{style:{color:"red"}},"(*)",-1),Et={key:0,class:"v-messages font-weight-black px-2 py-2"},Tt=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Nt=[Tt],zt=r("span",{style:{color:"red"}},"(*)",-1),Mt={key:0,class:"v-messages font-weight-black px-2 py-2"},At=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Lt=[At],qt=r("h4",{class:"mb-5 mt-2 primary"},[r("strong",null," Registro de repuestos:")],-1),Pt=r("span",{style:{color:"red"}},"(*)",-1),Ot={key:0,class:"v-messages font-weight-black px-2 py-2"},Jt=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Gt=[Jt],Ht=r("span",{style:{color:"red"}},"(*)",-1),jt={key:0,class:"v-messages font-weight-black px-2 py-2"},Kt=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Qt=[Kt],Wt=r("span",{style:{color:"red"}},"(*)",-1),Xt={key:0,class:"v-messages font-weight-black px-2 py-2"},Yt=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),Zt=[Yt],te=r("span",{style:{color:"red"}},"(*)",-1),ee={key:0,class:"v-messages font-weight-black px-2 py-2"},ae=r("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1),oe=[ae],re=r("span",{style:{color:"red"}},null,-1),se=r("thead",null,[r("tr",null,[r("th",{class:"text-center"},"N° "),r("th",{class:"text-center"},[r("b",null," Repuesto")]),r("th",{class:"text-center"},[r("b",null," Unidad")]),r("th",{class:"text-center"},[r("b",null," Cantidad")]),r("th",{class:"text-center"},[r("b",null," Precio Unitario")]),r("th",{class:"text-center"},[r("b",null,"Importe Bs.")]),r("th",{class:"text-center"},"Acción")])],-1),le={class:"text-center"},ie={class:"text-center"},de={class:"text-center"},ne={class:"text-center"},ue={class:"text-center"},me={class:"text-center"},fe={key:0,class:"text-center"},pe={key:1,class:"text-center"},ce=r("b",null," !Agotado¡",-1),_e=[ce],De={key:2,class:"text-center"},ve=r("td",null,null,-1),be=r("td",null,null,-1),ge=r("td",null,null,-1),Ve=r("td",null,null,-1),ye=r("td",{class:"text-center"},[r("b",null,"Total: ")],-1),he={class:"text-center"},xe=r("br",null,null,-1),we={class:"text-lg-left"},va=dt({__name:"registroForm",setup(ke){const J=Vt();gt();const h=vt(),x=c(!1),S=nt(),z=Dt(),M=bt();JSON.parse(localStorage.getItem("user")||"").id_perfil,JSON.parse(localStorage.getItem("user")||"").id_taller;const G=c({title:"Registro de Repuesto"}),H=c([{text:"Dashboard",disabled:!1,href:"#"},{text:"Información",disabled:!0,href:"#"}]),U=yt(new Date,"yyyy-MM-dd"),t=ut({formData:{id:"",fecha:U,id_taller:null,partida:"",total:"0",observacion:"",repuestos:[],nombre_repuesto:"",id_repuesto:"",cantidad:"",precio_u:"",subtotal:"",unidad:"",idd:""}}),A=c([]),j=async()=>{A.value=await J.fuerza()},K=c(!1),Q=c([]),W=async()=>{Q.value=await M.getDepartments()},X=c([]),I=c([]),f=c([]),Y=async()=>{X.value=await M.getSerivicio_t(),f.value=await z.repuestos(),I.value=await z.Unidad()},Z=async l=>{const e=await h.RegisterR(l);t.formData.id=e.id,t.formData.fecha=e.fecha,t.formData.partida=e.nro_partida,t.formData.id_taller=e.id_taller,t.formData.observacion=e.observacion;const _=e.repuestos;for(let p=0;p<_.length;p++)t.formData.repuestos.push(_[p]),f.value=f.value.filter(y=>y.id!=_[p].id_repuesto),t.formData.total=String(parseFloat(t.formData.total)+parseFloat(_[p].subtotal))},B=c(!0),k=async()=>{B.value=!0,(!t.formData.fecha||t.formData.repuestos.length==0)&&(B.value=!1)},tt=async l=>{const e=await h.infoR(l);t.formData.idd=e.idd,t.formData.id_repuesto=e.id_repuesto,t.formData.nombre_repuesto=e.nombre_repuesto,t.formData.cantidad=e.cantidad,t.formData.unidad=e.unidad,t.formData.precio_u=e.precio_u,t.formData.subtotal=e.subtotal,x.value=!0},et=()=>{t.formData.id_repuesto="",t.formData.nombre_repuesto="",t.formData.cantidad="",t.formData.unidad="",t.formData.precio_u=""},C=()=>{const l=parseFloat(t.formData.cantidad)||0,e=parseFloat(t.formData.precio_u)||0;t.formData.subtotal=(l*e).toFixed(2)},at=()=>{if(t.formData.id_repuesto&&t.formData.cantidad&&t.formData.unidad&&t.formData.precio_u){let l=f.value.find(e=>e.id==t.formData.id_repuesto);if(l)t.formData.nombre_repuesto=l.nombre_repuesto;else return;f.value=f.value.filter(e=>e.id!=t.formData.id_repuesto),t.formData.repuestos.push({id_repuesto:t.formData.id_repuesto,nombre_repuesto:l.nombre_repuesto,cantidad:t.formData.cantidad,unidad:t.formData.unidad,precio_u:t.formData.precio_u,subtotal:t.formData.subtotal}),t.formData.total=String(parseFloat(t.formData.total)+parseFloat(t.formData.subtotal)),t.formData.id_repuesto="",t.formData.nombre_repuesto="",t.formData.cantidad="",t.formData.unidad="",t.formData.precio_u="",t.formData.subtotal=""}},L=l=>{if(t.formData.repuestos.length>0){const e=t.formData.repuestos[l];f.value.push({id:e.id_repuesto,nombre_repuesto:e.nombre_repuesto}),t.formData.total=String(parseFloat(t.formData.total)-parseFloat(e.subtotal)),f.value.sort((_,p)=>{const y=_.id,a=p.id;return y<a?-1:y>a?1:0}),t.formData.repuestos.splice(l,1)}},ot=()=>{t.formData.id_repuesto&&t.formData.cantidad&&t.formData.unidad&&(f.value=f.value.filter(l=>l.id!=t.formData.id_repuesto),t.formData.repuestos.push({id_repuesto:t.formData.id_repuesto,nombre_repuesto:t.formData.nombre_repuesto,cantidad:t.formData.cantidad,unidad:t.formData.unidad,precio_u:t.formData.precio_u}),t.formData.id_repuesto="",t.formData.nombre_repuesto="",t.formData.cantidad="",t.formData.unidad="",t.formData.precio_u="")},rt=()=>{x.value=!1},st=()=>{ct.push({name:"registerList"})},n=c(!1),lt=async()=>{if(n.value=!0,await k(),!B.value)return;const{ok:l,message:e}=S.params.id=="0"?await h.createRegisterR(t.formData):await h.updateRegisterR(t.formData),_=l?"success":"error";O.fire({icon:_,title:e,timer:1500,showConfirmButton:!1,timerProgressBar:!0})},it=async()=>{n.value=!0,t.formData.idd!="0"&&(x.value=!1,O.fire({title:"Estás seguro?",text:"Verifica que la información registrada sea correcta",icon:"warning",showCancelButton:!0,cancelButtonColor:"#FA896B",confirmButtonColor:"#5D87FF",cancelButtonText:"No, volver",confirmButtonText:"Si, actualizar"}).then(async l=>{l.isConfirmed&&await h.updateInfo(t.formData),window.location.reload()}))};return mt(async()=>{await W(),await j(),await Y(),S.params.id!="0"&&(await Z(S.params.id),K.value=!0)}),(l,e)=>{const _=$("SearchIcon"),p=$("TrashIcon"),y=$("PencilIcon");return u(),m(P,null,[o(_t,{title:G.value.title,breadcrumbs:H.value},null,8,["title","breadcrumbs"]),o(T,null,{default:s(()=>[o(ht,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=a=>x.value=a),"max-width":"1000px"},{default:s(()=>[o(xt,null,{default:s(()=>[o(wt,{class:"pa-2 bg-primary"},{default:s(()=>[Bt]),_:1}),o(kt,null,{default:s(()=>[o(Rt,null,{default:s(()=>[o(T,null,{default:s(()=>[o(i,{cols:"12",md:"4"},{default:s(()=>[o(D,{modelValue:t.formData.nombre_repuesto,"onUpdate:modelValue":e[0]||(e[0]=a=>t.formData.nombre_repuesto=a),label:"Repuesto"},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(N,{variant:"outlined",color:"primary",label:"Unidad","hide-details":"",items:I.value,modelValue:t.formData.unidad,"onUpdate:modelValue":e[1]||(e[1]=a=>t.formData.unidad=a),"no-data-text":"No existe más opciones para seleccionar","item-value":"nombre_unidad","item-title":"nombre_unidad",onInput:e[2]||(e[2]=a=>t.formData.unidad=w(E)(t.formData.unidad.toUpperCase()))},null,8,["items","modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(D,{onInput:e[3]||(e[3]=a=>(C(),t.formData.cantidad)),modelValue:t.formData.cantidad,"onUpdate:modelValue":e[4]||(e[4]=a=>t.formData.cantidad=a),label:"Cantidad",type:"number",min:1},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(D,{onInput:e[5]||(e[5]=a=>(C(),t.formData.precio_u)),modelValue:t.formData.precio_u,"onUpdate:modelValue":e[6]||(e[6]=a=>t.formData.precio_u=a),label:"Precio Unitaro",type:"number",min:1},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(D,{modelValue:t.formData.subtotal,"onUpdate:modelValue":e[7]||(e[7]=a=>t.formData.subtotal=a),"min:0":"",label:"Importe",readonly:"",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(Ct,null,{default:s(()=>[o(St),o(b,{color:"error",variant:"flat",dark:"",onClick:e[8]||(e[8]=a=>rt())},{default:s(()=>[d(" Cancel ")]),_:1}),o(b,{color:"success",variant:"flat",dark:"",onClick:e[9]||(e[9]=a=>it())},{default:s(()=>[d(" Actualizar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(i,{cols:"12",lg:"12"},{default:s(()=>[Ft,o(T,null,{default:s(()=>[o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d(" Fecha de Registro"),$t]),_:1}),o(D,{type:"date",id:"date",name:"date",modelValue:t.formData.fecha,"onUpdate:modelValue":e[11]||(e[11]=a=>t.formData.fecha=a),min:w(U),max:w(U),error:n.value&&!t.formData.fecha,"hide-details":""},null,8,["modelValue","min","max","error"]),n.value&&!t.formData.fecha?(u(),m("div",Et,Nt)):v("",!0)]),_:1}),o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("N° de partida ")]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.partida,"onUpdate:modelValue":e[12]||(e[12]=a=>t.formData.partida=a),modelModifiers:{trim:!0},onInput:e[13]||(e[13]=a=>(k(),t.formData.partida)),error:n.value&&!t.formData.partida,"hide-details":""},null,8,["modelValue","error"])]),_:1}),o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Taller"),zt]),_:1}),o(Ut,{items:A.value,"item-title":"nombre_fuerza","item-value":"id_fuerza",modelValue:t.formData.id_taller,"onUpdate:modelValue":e[14]||(e[14]=a=>t.formData.id_taller=a),error:n.value&&!t.formData.id_taller},null,8,["items","modelValue","error"]),n.value&&!t.formData.id_taller?(u(),m("div",Mt,Lt)):v("",!0)]),_:1}),o(i,{cols:"12",md:"12"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Observación ")]),_:1}),o(D,{variant:"outlined",color:"primary",type:"text",modelValue:t.formData.observacion,"onUpdate:modelValue":e[15]||(e[15]=a=>t.formData.observacion=a),modelModifiers:{trim:!0},onInput:e[16]||(e[16]=a=>(k(),t.formData.observacion=w(E)(t.formData.observacion.toUpperCase()))),"hide-details":""},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"12"},{default:s(()=>[qt]),_:1}),o(i,{cols:"12",md:"3"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Repuestos "),Pt]),_:1}),o(N,{variant:"outlined",modelValue:t.formData.id_repuesto,"onUpdate:modelValue":e[17]||(e[17]=a=>t.formData.id_repuesto=a),items:f.value,"item-title":"nombre_repuesto","item-value":"id",onInput:e[18]||(e[18]=a=>k()),error:n.value&&!t.formData.id_repuesto,"hide-details":""},null,8,["modelValue","items","error"]),n.value&&!t.formData.id_repuesto?(u(),m("div",Ot,Gt)):v("",!0)]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Unidad"),Ht]),_:1}),o(N,{variant:"outlined",color:"primary","hide-details":"",items:I.value,modelValue:t.formData.unidad,"onUpdate:modelValue":[e[19]||(e[19]=a=>t.formData.unidad=a),e[21]||(e[21]=a=>ot())],"no-data-text":"No existe más opciones para seleccionar","item-value":"nombre_unidad","item-title":"nombre_unidad",onInput:e[20]||(e[20]=a=>t.formData.unidad=w(E)(t.formData.unidad.toUpperCase()))},null,8,["items","modelValue"]),n.value&&!t.formData.unidad?(u(),m("div",jt,Qt)):v("",!0)]),_:1}),o(i,{cols:"12",md:"1"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Cantidad "),Wt]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.cantidad,"onUpdate:modelValue":e[22]||(e[22]=a=>t.formData.cantidad=a),modelModifiers:{trim:!0},onInput:e[23]||(e[23]=a=>(C(),t.formData.cantidad)),min:1,error:n.value&&!t.formData.cantidad,"hide-details":""},null,8,["modelValue","error"]),n.value&&!t.formData.cantidad?(u(),m("div",Xt,Zt)):v("",!0)]),_:1}),o(i,{cols:"12",md:"2"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Precio Unitario "),te]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.precio_u,"onUpdate:modelValue":e[24]||(e[24]=a=>t.formData.precio_u=a),modelModifiers:{trim:!0},onInput:e[25]||(e[25]=a=>(C(),t.formData.precio_u)),min:1,error:n.value&&!t.formData.precio_u,"hide-details":""},null,8,["modelValue","error"]),n.value&&!t.formData.precio_u?(u(),m("div",ee,oe)):v("",!0)]),_:1}),o(i,{cols:"12",md:"4"},{default:s(()=>[o(g,{class:"mb-2 font-weight-medium"},{default:s(()=>[d("Importe Bs."),re]),_:1}),o(D,{variant:"outlined",color:"primary",type:"number",modelValue:t.formData.subtotal,"onUpdate:modelValue":e[28]||(e[28]=a=>t.formData.subtotal=a),modelModifiers:{trim:!0},readonly:"",error:n.value&&!t.formData.subtotal,"hide-details":""},{append:s(()=>[o(b,{color:"primary",onClick:e[26]||(e[26]=a=>at()),disabled:!t.formData.id_repuesto||!t.formData.cantidad||!t.formData.unidad||!t.formData.precio_u,readonly:"true"},{default:s(()=>[o(_),d("Añadir ")]),_:1},8,["disabled"]),o(b,{color:"secondary",onClick:e[27]||(e[27]=a=>et()),disabled:!t.formData.id_repuesto||!t.formData.cantidad||!t.formData.unidad||!t.formData.precio_u},{default:s(()=>[o(p),d("Limpiar ")]),_:1},8,["disabled"])]),_:1},8,["modelValue","error"])]),_:1}),t.formData.repuestos.length>0?(u(),F(i,{key:0,cols:"12",md:"12"},{default:s(()=>[o(It,{density:"compact"},{default:s(()=>[se,r("tbody",null,[(u(!0),m(P,null,ft(t.formData.repuestos,(a,R)=>(u(),m("tr",{key:R},[r("td",le,V(R+1),1),r("td",ie,V(a.nombre_repuesto),1),r("td",de,V(a.unidad),1),r("td",ne,V(a.cantidad),1),r("td",ue,V(a.precio_u),1),r("td",me,V(a.subtotal),1),a.entregado!=a.cantidad&&t.formData.id!=""?(u(),m("td",fe,[a.idd!=null?(u(),F(b,{key:0,class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"primary",text:"hola",onClick:q=>tt(a.idd)},{default:s(()=>[o(y)]),_:2},1032,["onClick"])):v("",!0),a.entregado===null||a.entregado===0||a.idd==null?(u(),F(b,{key:1,size:"x-small",title:"Eliminar",height:"25",width:"25",color:"error",onClick:q=>L(R)},{default:s(()=>[o(p)]),_:2},1032,["onClick"])):v("",!0)])):(a.entregado=a.cantidad)&&t.formData.id!=""?(u(),m("td",pe,_e)):(u(),m("td",De,[o(b,{size:"x-small",title:"Eliminar",height:"25",width:"25",color:"error",onClick:q=>L(R)},{default:s(()=>[o(p)]),_:2},1032,["onClick"])]))]))),128)),r("tr",null,[ve,be,ge,Ve,ye,r("td",he,V(t.formData.total)+" Bs.",1)])])]),_:1})]),_:1})):v("",!0)]),_:1}),xe,r("p",we,[o(b,{color:"error",class:"mr-3",onClick:e[29]||(e[29]=a=>st())},{default:s(()=>[d("Cancelar")]),_:1}),o(b,{color:"primary",onClick:e[30]||(e[30]=pt(a=>lt(),["prevent"]))},{default:s(()=>[d("Enviar")]),_:1})])]),_:1})]),_:1})],64)}}});export{va as default};
